<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Voice App Architecture Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Visualization & Content Choices: 
        - High-Level Architecture Diagram (Mermaid in source): Recreated as an HTML/CSS interactive diagram (divs for nodes, click to show details). Goal: Understand system structure. Justification: Visual overview with drill-down. Method: Vanilla JS, HTML, Tailwind.
        - Component Breakdown: Cards/expandable sections. Goal: Detail components. Interaction: Click reveals details. Justification: Organized access. Method: Vanilla JS, HTML, Tailwind.
        - Feature Flows: Step-by-step visual sequences. Goal: Show feature implementation. Interaction: Select feature to view flow. Justification: Clarifies processes. Method: Vanilla JS, HTML, Tailwind.
        - API Endpoints: Tabulated list, expandable rows. Goal: Developer reference. Interaction: Filter/expand. Justification: Easy lookup. Method: Vanilla JS, HTML, Tailwind.
        - Database Schema: HTML tables or visual blocks. Goal: Understand data structure. Justification: Clear presentation. Method: HTML, Tailwind.
        - Textual Content (Security, etc.): Formatted text, collapsible sections. Goal: Inform on non-functional aspects. Justification: Standard presentation. Method: HTML, Tailwind.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .content-section { display: none; }
        .content-section.active { display: block; }
        .diagram-node { cursor: pointer; transition: all 0.2s ease-in-out; }
        .diagram-node:hover { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .connector {
            position: absolute;
            background-color: #9ca3af; /* gray-400 */
            z-index: -1;
        }
        .h-connector { height: 2px; }
        .v-connector { width: 2px; }
        .arrow {
            border: solid #9ca3af;
            border-width: 0 2px 2px 0;
            display: inline-block;
            padding: 3px;
            position: absolute;
        }
        .arrow-right { transform: rotate(-45deg); }
        .arrow-down { transform: rotate(45deg); }
        .arrow-left { transform: rotate(135deg); }
        .arrow-up { transform: rotate(-135deg); }

        /* Basic styling for chart-like containers if any visual block needs it */
        .chart-container-like {
            position: relative;
            width: 100%;
            max-width: 800px; /* Example max-width */
            margin-left: auto;
            margin-right: auto;
            height: auto; /* Adjust based on content */
            min-height: 200px; /* Example min-height */
            max-height: 600px; /* Example max-height */
            overflow-y: auto; /* If content might overflow */
            border: 1px solid #e5e7eb; /* gray-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            background-color: #f9fafb; /* gray-50 */
        }
        @media (min-width: 768px) {
            .chart-container-like {
                padding: 1.5rem; /* md:p-6 */
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex">

    <aside id="sidebar" class="bg-sky-700 text-white w-64 min-h-screen p-4 space-y-2 fixed top-0 left-0 z-20 sidebar md:translate-x-0 -translate-x-full">
        <h1 class="text-2xl font-semibold mb-6">App Architecture</h1>
        <nav>
            <a href="#home" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Home</a>
            <a href="#diagram" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Architecture Diagram</a>
            <a href="#components" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Core Components</a>
            <a href="#features" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Feature Flows</a>
            <a href="#api" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">API Reference</a>
            <a href="#database" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Data Models</a>
            <a href="#techstack" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Technology Stack</a>
            <a href="#security" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Security</a>
            <a href="#scalability" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Scalability & Performance</a>
            <a href="#errorhandling" class="block py-2.5 px-4 rounded hover:bg-sky-600 transition duration-200 nav-link">Error Handling</a>
        </nav>
    </aside>

    <button id="menu-toggle" class="md:hidden fixed top-4 left-4 z-30 p-2 bg-sky-700 text-white rounded-md">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
    </button>

    <main id="main-content" class="flex-1 p-6 md:ml-64">
        <section id="home" class="content-section active">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Welcome to the Interactive Voice App Architecture Viewer</h2>
            <p class="mb-4 text-lg">This application provides an interactive way to explore the "Web + Mobile App Architecture Design" document. The original document details a microservices-based architecture for an application with advanced audio processing features. This viewer aims to make that complex information more digestible and easier to navigate.</p>
            <p class="mb-4">Use the sidebar navigation to jump between different aspects of the architecture, such as the overall diagram, detailed component breakdowns, feature implementation flows, API specifications, and key design considerations like security and scalability. The goal is to help you understand the system's structure, how its parts interact, and how user features are realized.</p>
             <div class="mt-6 p-6 bg-white rounded-lg shadow-md">
                <h3 class="text-xl font-semibold mb-3 text-sky-600">How to Use This Viewer:</h3>
                <ul class="list-disc list-inside space-y-2 text-slate-700">
                    <li><strong class="font-semibold">Navigation:</strong> Click on the links in the sidebar to explore different sections of the architecture.</li>
                    <li><strong class="font-semibold">Interactive Diagram:</strong> In the "Architecture Diagram" section, click on component blocks to see more details.</li>
                    <li><strong class="font-semibold">Expandable Content:</strong> Look for elements that might expand or reveal more information on click, especially in the API Reference and Feature Flows sections.</li>
                    <li><strong class="font-semibold">Responsive Design:</strong> The viewer is designed to be responsive and accessible on various screen sizes. On mobile, use the menu icon to toggle the sidebar.</li>
                </ul>
            </div>
        </section>

        <section id="diagram" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Architecture Diagram</h2>
            <p class="mb-6 text-lg">This section presents a simplified, interactive representation of the high-level system architecture. The original document uses a Mermaid diagram; here, we use HTML and CSS for a similar visual overview. Click on a component block to learn more about it. Lines and arrows indicate primary data flow or interaction paths.</p>
            <div class="bg-white p-6 rounded-lg shadow-md chart-container-like overflow-x-auto">
                <div id="architecture-diagram-container" class="relative grid grid-cols-1 md:grid-cols-3 gap-8 items-start min-w-[800px] md:min-w-full">
                    <div class="col-span-1 md:col-span-3 flex justify-center mb-8">
                        <div id="node-user" data-component="User" class="diagram-node bg-amber-400 text-amber-900 p-4 rounded-lg shadow-md text-center w-48">User</div>
                    </div>
                    <div class="col-span-1 md:col-span-3 flex justify-center mb-8">
                        <div id="node-clientapps" data-component="ClientApps" class="diagram-node bg-sky-400 text-sky-900 p-4 rounded-lg shadow-md text-center w-48">Client Applications (Web/Mobile)</div>
                    </div>
                     <div class="col-span-1 md:col-span-3 flex justify-center mb-8">
                        <div id="node-apigateway" data-component="APIGateway" class="diagram-node bg-teal-400 text-teal-900 p-4 rounded-lg shadow-md text-center w-48">API Gateway</div>
                    </div>

                    <div class="md:col-start-1 md:col-span-1 space-y-6 flex flex-col items-center">
                        <div id="node-authservice" data-component="AuthService" class="diagram-node bg-indigo-400 text-indigo-900 p-3 rounded-lg shadow-md text-center w-44">Auth Service</div>
                        <div id="node-userservice" data-component="UserService" class="diagram-node bg-indigo-400 text-indigo-900 p-3 rounded-lg shadow-md text-center w-44">User Service</div>
                        <div id="node-voicelibservice" data-component="VoiceLibService" class="diagram-node bg-indigo-400 text-indigo-900 p-3 rounded-lg shadow-md text-center w-44">Voice Library Service</div>
                    </div>
                     <div class="md:col-start-2 md:col-span-1 space-y-6 flex flex-col items-center">
                        <div id="node-ttsservice" data-component="TTSService" class="diagram-node bg-purple-400 text-purple-900 p-3 rounded-lg shadow-md text-center w-44">TTS Service</div>
                        <div id="node-sttservice" data-component="STTService" class="diagram-node bg-purple-400 text-purple-900 p-3 rounded-lg shadow-md text-center w-44">STT Service</div>
                    </div>
                    <div class="md:col-start-3 md:col-span-1 space-y-6 flex flex-col items-center">
                        <div id="node-audioprocservice" data-component="AudioProcService" class="diagram-node bg-pink-400 text-pink-900 p-3 rounded-lg shadow-md text-center w-44">Audio Proc. Service</div>
                        <div id="node-musicsfxservice" data-component="MusicSFXService" class="diagram-node bg-pink-400 text-pink-900 p-3 rounded-lg shadow-md text-center w-44">Music/SFX Service</div>
                    </div>

                    <div class="col-span-1 md:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-8 mt-8 pt-8 border-t-2 border-slate-200">
                        <div class="space-y-4 flex flex-col items-center">
                            <h4 class="font-semibold text-slate-600">AI/ML Engines</h4>
                            <div id="node-mltts" data-component="ML_TTS_Engine" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML TTS Engine</div>
                            <div id="node-mlstt" data-component="ML_STT_Engine" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML STT Engine</div>
                            <div id="node-mlvoicecloning" data-component="ML_Voice_Cloning" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML Voice Cloning</div>
                            <div id="node-mlnoisereduction" data-component="ML_Noise_Reduction" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML Noise Reduction</div>
                            <div id="node-mlmusicgen" data-component="ML_Music_Gen" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML Music Gen</div>
                            <div id="node-mlsfxgen" data-component="ML_SFX_Gen" class="diagram-node bg-rose-300 text-rose-800 p-2 rounded shadow text-center w-40 text-sm">ML SFX Gen</div>
                        </div>
                        <div class="space-y-4 flex flex-col items-center">
                            <h4 class="font-semibold text-slate-600">Databases</h4>
                            <div id="node-userdb" data-component="User_DB" class="diagram-node bg-lime-300 text-lime-800 p-2 rounded shadow text-center w-40 text-sm">User DB</div>
                            <div id="node-projectdb" data-component="Project_DB" class="diagram-node bg-lime-300 text-lime-800 p-2 rounded shadow text-center w-40 text-sm">Project DB</div>
                            <div id="node-voicedb" data-component="Voice_DB" class="diagram-node bg-lime-300 text-lime-800 p-2 rounded shadow text-center w-40 text-sm">Voice DB</div>
                        </div>
                        <div class="space-y-4 flex flex-col items-center">
                            <h4 class="font-semibold text-slate-600">Infrastructure</h4>
                            <div id="node-filestorage" data-component="File_Storage" class="diagram-node bg-cyan-300 text-cyan-800 p-2 rounded shadow text-center w-40 text-sm">File Storage</div>
                            <div id="node-messagequeue" data-component="Message_Queue" class="diagram-node bg-cyan-300 text-cyan-800 p-2 rounded shadow text-center w-40 text-sm">Message Queue</div>
                            <div id="node-cdn" data-component="CDN" class="diagram-node bg-cyan-300 text-cyan-800 p-2 rounded shadow text-center w-40 text-sm">CDN</div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="diagram-details" class="mt-6 p-4 bg-sky-50 rounded-lg shadow hidden">
                <h3 id="details-title" class="text-xl font-semibold text-sky-700 mb-2">Component Details</h3>
                <p id="details-description" class="text-slate-700"></p>
            </div>
        </section>

        <section id="components" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Core Components</h2>
            <p class="mb-6 text-lg">This section provides a detailed breakdown of each major component in the architecture. The system is designed around microservices, AI/ML models, databases, and other supporting infrastructure. Each component plays a specific role in delivering the application's functionalities.</p>
            <div id="components-container" class="space-y-6"></div>
        </section>

        <section id="features" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Feature Flows</h2>
            <p class="mb-6 text-lg">Explore how each of the 9 core user features is implemented across the system architecture. Understanding these flows helps clarify the interactions between different microservices and components to achieve a specific user outcome.</p>
            <div class="mb-4">
                <label for="feature-select" class="block text-sm font-medium text-slate-700 mb-1">Select a feature to view its flow:</label>
                <select id="feature-select" class="block w-full md:w-1/2 p-2 border border-slate-300 rounded-md shadow-sm focus:ring-sky-500 focus:border-sky-500">
                </select>
            </div>
            <div id="feature-flow-display" class="p-6 bg-white rounded-lg shadow-md min-h-[200px]">
                <p class="text-slate-500 italic">Select a feature from the dropdown above to see its detailed flow.</p>
            </div>
        </section>

        <section id="api" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">API Reference</h2>
            <p class="mb-6 text-lg">This section outlines the example RESTful API endpoints for interacting with the backend services. These endpoints define how client applications communicate with the microservices to perform various operations.</p>
            <div id="api-endpoints-container" class="space-y-4"></div>
        </section>

        <section id="database" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Data Models (Database Schema)</h2>
            <p class="mb-6 text-lg">A simplified overview of the database schemas for storing user data, project information, and voice profiles. These schemas are crucial for organizing and managing the application's data persistently.</p>
            <div id="database-schemas-container" class="space-y-8"></div>
        </section>

        <section id="techstack" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Technology Stack</h2>
            <p class="mb-6 text-lg">The recommended technologies for building this application are listed here. These choices aim for a modern, scalable, and maintainable system, covering frontend, backend, databases, AI/ML, and cloud infrastructure.</p>
            <div id="techstack-container" class="bg-white p-6 rounded-lg shadow-md"></div>
        </section>

        <section id="security" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Security Considerations</h2>
            <p class="mb-6 text-lg">Security is a critical aspect of the application design. This section outlines key security measures and best practices to protect user data and ensure the integrity of the system.</p>
            <div id="security-content" class="bg-white p-6 rounded-lg shadow-md prose max-w-none"></div>
        </section>

        <section id="scalability" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Scalability & Performance</h2>
            <p class="mb-6 text-lg">The architecture is designed with scalability and performance in mind to handle a growing number of users and data. This section details the strategies employed to achieve this.</p>
            <div id="scalability-content" class="bg-white p-6 rounded-lg shadow-md prose max-w-none"></div>
        </section>

        <section id="errorhandling" class="content-section">
            <h2 class="text-3xl font-bold mb-4 text-sky-700">Error Handling & Monitoring</h2>
            <p class="mb-6 text-lg">Robust error handling and comprehensive monitoring are essential for maintaining a reliable application. This section covers the approaches for managing errors and observing system health.</p>
            <div id="errorhandling-content" class="bg-white p-6 rounded-lg shadow-md prose max-w-none"></div>
        </section>

    </main>

<script>
    const appData = {
        components: {
            "User": "The end-user interacting with the client applications.",
            "ClientApps": {
                title: "Client Applications (Web & Mobile)",
                description: "User-facing interfaces. Web App (React.js) and Mobile Apps (React Native). Handles user authentication, project management, input forms, audio playback, real-time feedback.",
                details: [
                    "Web App: Built with React.js, providing a rich, interactive user interface.",
                    "Mobile Apps: Built with React Native (for iOS and Android), offering a consistent experience across platforms.",
                    "Functionality: User authentication, project management, input forms (text, audio upload/record), audio playback, real-time feedback."
                ]
            },
            "APIGateway": {
                title: "API Gateway",
                description: "Single entry point for all client requests. Acts as a reverse proxy, routing requests to appropriate microservices. Handles authentication token validation (JWT). Implements rate limiting and basic security checks."
            },
            "AuthService": {
                title: "Authentication Service",
                description: "Handles user authentication (e.g., JWT token generation and validation)."
            },
            "UserService": {
                title: "User Service",
                description: "Manages user registration, login, profiles, and permissions."
            },
            "TTSService": {
                title: "Text-to-Speech (TTS) Service",
                description: "Converts text input into spoken audio. Integrates with a core TTS engine. Handles voice selection, accent, and language parameters."
            },
            "STTService": {
                title: "Speech-to-Text (STT) Service",
                description: "Transcribes spoken audio into text. Integrates with a core STT engine."
            },
            "VoiceLibService": {
                title: "Voice Library Service",
                description: "Manages a library of pre-defined voices. Handles user-uploaded voice samples for cloning/adaptation. Stores voice metadata and links to voice models."
            },
            "AudioProcService": {
                title: "Audio Processing Service",
                description: "Handles noise reduction from audio files. Manages audio editing (e.g., word replacement by re-synthesis)."
            },
            "MusicSFXService": {
                title: "Music & Sound Effects Service",
                description: "Generates background music based on user input (mood, genre, etc.). Generates sound effects based on user descriptions."
            },
            "ML_TTS_Engine": { title: "AI/ML: TTS Engine", description: "Converts text to audio (e.g., Google Cloud Text-to-Speech, AWS Polly, or custom models)." },
            "ML_STT_Engine": { title: "AI/ML: STT Engine", description: "Converts audio to text (e.g., Google Cloud Speech-to-Text, AWS Transcribe, or custom models)." },
            "ML_Voice_Cloning": { title: "AI/ML: Voice Cloning/Adaptation Model", description: "Learns from user-uploaded voice samples to create new voice profiles." },
            "ML_Noise_Reduction": { title: "AI/ML: Noise Reduction Model", description: "Filters out unwanted noise from audio (e.g., trained deep learning models)." },
            "ML_Music_Gen": { title: "AI/ML: Music Generation Model", description: "Generates musical compositions (e.g., AI music generators)." },
            "ML_SFX_Gen": { title: "AI/ML: Sound Effect Generation Model", description: "Generates specific sound effects (e.g., AI sound synthesis)." },
            "User_DB": { title: "Database: User Database", description: "Stores user credentials, profiles, and subscription information (e.g., PostgreSQL, MongoDB)." },
            "Project_DB": { title: "Database: Project Database", description: "Stores metadata about user projects, generated audio files, original text/audio inputs (e.g., PostgreSQL, MongoDB)." },
            "Voice_DB": { title: "Database: Voice Library Database", description: "Stores metadata about available voices (pre-defined and user-uploaded) (e.g., PostgreSQL, MongoDB)." },
            "File_Storage": { title: "Infrastructure: File Storage", description: "Object storage for all audio files (e.g., AWS S3, Google Cloud Storage). Includes user-uploaded samples, original inputs, generated TTS, music/SFX, and processed audio." },
            "Message_Queue": { title: "Infrastructure: Message Queue", description: "For asynchronous processing of computationally intensive tasks (e.g., voice cloning, long audio processing, music/SFX generation). (e.g., RabbitMQ, Apache Kafka, AWS SQS)." },
            "CDN": { title: "Infrastructure: CDN (Content Delivery Network)", description: "Distributes generated audio files globally for faster playback and download speeds." }
        },
        featureFlows: [
            {
                name: "1. Convert Text to Speech (TTS)",
                steps: [
                    "User inputs text on Web/Mobile App.",
                    "App sends text, selected voice ID, language, and accent to TTS Service via API Gateway.",
                    "TTS Service calls the TTS Engine, generates audio.",
                    "Audio is stored in File Storage.",
                    "TTS Service returns the audio URL to the App.",
                    "App plays the audio from the CDN."
                ]
            },
            {
                name: "2. Change Voice (Library/Upload)",
                steps: [
                    "<strong>From Library:</strong> User selects a voice from a list (Voice Library Service). Selected voice ID passed to TTS Service.",
                    "<strong>User Uploads Sample Voice:</strong>",
                    "  User records/uploads voice sample via App.",
                    "  App uploads audio to File Storage.",
                    "  App sends request to Voice Library Service with audio URL.",
                    "  Voice Library Service uses ML Voice Cloning Model to create new voice profile.",
                    "  New profile stored in Voice Library DB & File Storage, becomes available for TTS."
                ]
            },
            {
                name: "3. Change Accent",
                steps: [
                    "User selects an accent from the App.",
                    "Accent parameter is passed to TTS Service.",
                    "TTS Service forwards it to the TTS Engine."
                ]
            },
            {
                name: "4. Change Language (Dub)",
                steps: [
                    "User uploads original audio to App.",
                    "App uploads audio to File Storage.",
                    "App sends request to STT Service for transcription.",
                    "STT Service transcribes audio to text.",
                    "(Optional: Text sent to Translation Service if needed).",
                    "Transcribed/translated text sent to TTS Service with target language & voice.",
                    "Generated dubbed audio is stored and returned."
                ]
            },
            {
                name: "5. Edit a Word in Voice",
                steps: [
                    "User uploads/selects audio.",
                    "App sends audio to STT Service for transcript with timestamps.",
                    "User identifies word to edit in transcript on App & inputs new word/phrase.",
                    "App sends original audio segment (or context), new word, voice params to Audio Processing Service.",
                    "Audio Processing Service re-synthesizes word/phrase using TTS Engine & stitches it back.",
                    "Edited audio stored and returned."
                ]
            },
            {
                name: "6. Remove Noise from Voice",
                steps: [
                    "User uploads audio to App.",
                    "App uploads audio to File Storage.",
                    "App sends request to Audio Processing Service with audio URL.",
                    "Audio Processing Service uses ML Noise Reduction Model to clean audio.",
                    "Cleaned audio stored in File Storage, URL returned to App."
                ]
            },
            {
                name: "7. Make Background Music",
                steps: [
                    "User provides input (mood, genre, duration) on App.",
                    "App sends request to Music & Sound Effects Service.",
                    "Music & Sound Effects Service uses ML Music Generation Model.",
                    "Generated music stored in File Storage, URL returned."
                ]
            },
            {
                name: "8. Make Sound Effect",
                steps: [
                    "User provides description (e.g., 'door creak') on App.",
                    "App sends request to Music & Sound Effects Service.",
                    "Music & Sound Effects Service uses ML Sound Effect Generation Model.",
                    "Generated SFX stored in File Storage, URL returned."
                ]
            },
            {
                name: "9. Speech to Text (STT)",
                steps: [
                    "User uploads or records audio on App.",
                    "App uploads audio to File Storage.",
                    "App sends request to STT Service with audio URL.",
                    "STT Service uses STT Engine to transcribe audio.",
                    "Transcribed text returned to App."
                ]
            }
        ],
        apiEndpoints: [
            {
                group: "Authentication",
                endpoints: [
                    { method: "POST", path: "/api/auth/register", description: "User registration." },
                    { method: "POST", path: "/api/auth/login", description: "User login, returns JWT." },
                    { method: "GET", path: "/api/auth/me", description: "Get current user profile (requires JWT)." }
                ]
            },
            {
                group: "User & Project Management",
                endpoints: [
                    { method: "GET", path: "/api/users/{userId}/projects", description: "Get user's projects." },
                    { method: "POST", path: "/api/projects", description: "Create a new project." },
                    { method: "GET", path: "/api/projects/{projectId}", description: "Get project details." },
                    { method: "PUT", path: "/api/projects/{projectId}", description: "Update project." },
                    { method: "DELETE", path: "/api/projects/{projectId}", description: "Delete project." }
                ]
            },
            {
                group: "Text-to-Speech (TTS)",
                endpoints: [
                    { method: "POST", path: "/api/tts", description: "Convert text to speech.", requestBody: '{ "text": "...", "voiceId": "...", "language": "en-US", "accent": "..." }', responseBody: '{ "audioUrl": "...", "projectId": "..." }' }
                ]
            },
            {
                group: "Speech-to-Text (STT)",
                endpoints: [
                    { method: "POST", path: "/api/stt", description: "Convert speech to text.", requestBody: '{ "audioUrl": "...", "language": "en-US" }', responseBody: '{ "transcript": "...", "projectId": "..." }' }
                ]
            },
            {
                group: "Voice Library",
                endpoints: [
                    { method: "GET", path: "/api/voices", description: "Get list of available voices." },
                    { method: "POST", path: "/api/voices/upload", description: "Upload voice sample for cloning.", requestBody: '{ "sampleAudioUrl": "...", "voiceName": "..." }', responseBody: '{ "voiceId": "...", "status": "processing" }' }
                ]
            },
            {
                group: "Audio Processing",
                endpoints: [
                    { method: "POST", path: "/api/audio/noise-reduction", description: "Remove noise from audio.", requestBody: '{ "inputAudioUrl": "..." }', responseBody: '{ "outputAudioUrl": "...", "projectId": "..." }' },
                    { method: "POST", path: "/api/audio/edit-word", description: "Edit a word in an audio segment.", requestBody: '{ "originalAudioUrl": "...", "segmentStartTime": "...", "segmentEndTime": "...", "newText": "...", "voiceId": "..." }', responseBody: '{ "outputAudioUrl": "...", "projectId": "..." }' }
                ]
            },
            {
                group: "Music & Sound Effects Generation",
                endpoints: [
                    { method: "POST", path: "/api/audio/music", description: "Generate background music.", requestBody: '{ "mood": "...", "genre": "...", "duration": "..." }', responseBody: '{ "audioUrl": "...", "projectId": "..." }' },
                    { method: "POST", path: "/api/audio/sfx", description: "Generate sound effect.", requestBody: '{ "description": "..." }', responseBody: '{ "audioUrl": "...", "projectId": "..." }' }
                ]
            }
        ],
        databaseSchemas: [
            {
                name: "<code>users</code> table",
                fields: [
                    { name: "id", type: "PK, UUID", description: "Primary Key" },
                    { name: "email", type: "UNIQUE", description: "User's email address" },
                    { name: "password_hash", type: "String", description: "Hashed password" },
                    { name: "created_at", type: "Timestamp", description: "Record creation time" },
                    { name: "updated_at", type: "Timestamp", description: "Record last update time" },
                    { name: "subscription_plan", type: "String", description: "User's subscription plan" }
                ]
            },
            {
                name: "<code>projects</code> table",
                fields: [
                    { name: "id", type: "PK, UUID", description: "Primary Key" },
                    { name: "user_id", type: "FK to users.id", description: "Foreign key to users table" },
                    { name: "name", type: "String", description: "Project name" },
                    { name: "description", type: "Text", description: "Project description" },
                    { name: "original_text", type: "Text", description: "Original text for TTS projects" },
                    { name: "original_audio_url", type: "String", description: "URL to original audio for STT/processing" },
                    { name: "generated_audio_url", type: "String", description: "URL to the generated audio file" },
                    { name: "created_at", type: "Timestamp", description: "Record creation time" },
                    { name: "updated_at", type: "Timestamp", description: "Record last update time" }
                ]
            },
            {
                name: "<code>voice_profiles</code> table",
                fields: [
                    { name: "id", type: "PK, UUID", description: "Primary Key" },
                    { name: "name", type: "String", description: "Voice name" },
                    { name: "type", type: "String", description: "e.g., 'system', 'user_cloned'" },
                    { name: "language_code", type: "String", description: "e.g., 'en-US'" },
                    { name: "accent_code", type: "String", description: "e.g., 'standard'" },
                    { name: "gender", type: "String", description: "e.g., 'male', 'female'" },
                    { name: "description", type: "Text", description: "Voice description" },
                    { name: "audio_sample_url", type: "String", description: "URL for voice preview sample" },
                    { name: "model_data_path", type: "String", description: "Path to voice model files (for user-cloned)" },
                    { name: "user_id", type: "FK to users.id", description: "Foreign key to users (NULL for system voices)" }
                ]
            }
        ],
        techStack: {
            "Frontend (Web)": "React.js, Next.js (for SSR/SSG), Tailwind CSS, React Query/SWR for data fetching, Zustand/Jotai for state management.",
            "Frontend (Mobile)": "React Native, Expo (for faster development), NativeBase/Shadcn UI for components.",
            "Backend": "Python (FastAPI/Django REST Framework) or Node.js (Express.js/NestJS).",
            "Containerization": "Docker.",
            "Orchestration": "Kubernetes (for microservices deployment and scaling).",
            "Databases": "PostgreSQL (for relational data), MongoDB (for flexible document data if needed).",
            "File Storage": "AWS S3, Google Cloud Storage, or Azure Blob Storage.",
            "Message Queue": "RabbitMQ, Apache Kafka, or AWS SQS/SNS.",
            "AI/ML Frameworks": "TensorFlow, PyTorch (for custom model development).",
            "Cloud Providers": "AWS, Google Cloud Platform (GCP), or Microsoft Azure.",
            "Authentication": "JWT (JSON Web Tokens).",
            "Monitoring & Logging": "Prometheus/Grafana, ELK Stack (Elasticsearch, Logstash, Kibana), or cloud-native solutions (e.g., CloudWatch, Stackdriver)."
        },
        security: `
            <ul>
                <li><strong>Authentication & Authorization:</strong> JWT for API access, role-based access control (RBAC) for features.</li>
                <li><strong>Data Encryption:</strong>
                    <ul>
                        <li><strong>In Transit:</strong> HTTPS/SSL for all communication.</li>
                        <li><strong>At Rest:</strong> Encrypt databases and file storage.</li>
                    </ul>
                </li>
                <li><strong>Input Validation:</strong> Sanitize and validate all user inputs to prevent injection attacks (SQL, XSS).</li>
                <li><strong>API Rate Limiting:</strong> Protect against abuse and DDoS attacks.</li>
                <li><strong>Secure Credential Management:</strong> Use environment variables or secret management services for API keys and database credentials.</li>
                <li><strong>Regular Security Audits:</strong> Penetration testing and vulnerability scanning.</li>
                <li><strong>User Data Privacy:</strong> Comply with data protection regulations (GDPR, CCPA).</li>
            </ul>
        `,
        scalability: `
            <ul>
                <li><strong>Microservices:</strong> Allows independent scaling of individual services based on demand.</li>
                <li><strong>Load Balancing:</strong> Distributes incoming traffic across multiple instances of services.</li>
                <li><strong>Asynchronous Processing:</strong> Use message queues for long-running tasks (voice cloning, complex audio processing) to prevent blocking the main API thread.</li>
                <li><strong>Caching:</strong> Implement caching at the API Gateway and within services for frequently accessed data (e.g., voice library metadata).</li>
                <li><strong>CDN:</strong> Reduces latency for audio file delivery by serving content from edge locations closer to users.</li>
                <li><strong>Database Sharding/Replication:</strong> For horizontal scaling and high availability of databases.</li>
                <li><strong>Auto-scaling:</strong> Configure cloud resources to automatically scale up/down based on traffic.</li>
            </ul>
        `,
        errorHandling: `
            <ul>
                <li><strong>Centralized Logging:</strong> Aggregate logs from all services into a central system (e.g., ELK stack, Splunk, cloud-native logging).</li>
                <li><strong>Monitoring & Alerting:</strong> Set up dashboards and alerts for system health, performance metrics, and error rates.</li>
                <li><strong>Graceful Degradation:</strong> Design services to degrade gracefully under heavy load or partial failures.</li>
                <li><strong>Retry Mechanisms:</strong> Implement exponential backoff and retry logic for inter-service communication.</li>
                <li><strong>Circuit Breakers:</strong> Prevent cascading failures in a microservices architecture.</li>
            </ul>
        `
    };

    document.addEventListener('DOMContentLoaded', () => {
        const navLinks = document.querySelectorAll('.nav-link');
        const contentSections = document.querySelectorAll('.content-section');
        const sidebar = document.getElementById('sidebar');
        const menuToggle = document.getElementById('menu-toggle');
        const mainContent = document.getElementById('main-content');

        const diagramNodes = document.querySelectorAll('.diagram-node');
        const detailsPanel = document.getElementById('diagram-details');
        const detailsTitle = document.getElementById('details-title');
        const detailsDescription = document.getElementById('details-description');
        
        const componentsContainer = document.getElementById('components-container');
        const featureSelect = document.getElementById('feature-select');
        const featureFlowDisplay = document.getElementById('feature-flow-display');
        const apiEndpointsContainer = document.getElementById('api-endpoints-container');
        const databaseSchemasContainer = document.getElementById('database-schemas-container');
        const techstackContainer = document.getElementById('techstack-container');
        const securityContent = document.getElementById('security-content');
        const scalabilityContent = document.getElementById('scalability-content');
        const errorhandlingContent = document.getElementById('errorhandling-content');

        function navigateToSection(hash) {
            contentSections.forEach(section => {
                if (`#${section.id}` === hash) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });
            // Highlight active nav link
            navLinks.forEach(link => {
                if (link.getAttribute('href') === hash) {
                    link.classList.add('bg-sky-800', 'font-semibold');
                } else {
                    link.classList.remove('bg-sky-800', 'font-semibold');
                }
            });
            // Close sidebar on mobile after navigation
            if (window.innerWidth < 768) {
                sidebar.classList.add('-translate-x-full');
            }
        }

        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href');
                navigateToSection(targetId);
                window.location.hash = targetId; // Update URL hash
            });
        });

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
        });
        
        mainContent.addEventListener('click', () => {
            if (window.innerWidth < 768 && !sidebar.classList.contains('-translate-x-full')) {
                 sidebar.classList.add('-translate-x-full');
            }
        });

        // Initial navigation based on URL hash or default to #home
        const currentHash = window.location.hash || '#home';
        navigateToSection(currentHash);


        // Populate diagram node interactions
        diagramNodes.forEach(node => {
            node.addEventListener('click', () => {
                const componentKey = node.dataset.component;
                const componentData = appData.components[componentKey];
                if (componentData) {
                    detailsTitle.textContent = typeof componentData === 'string' ? componentKey : componentData.title || componentKey;
                    detailsDescription.textContent = typeof componentData === 'string' ? componentData : componentData.description;
                    detailsPanel.classList.remove('hidden');
                }
            });
        });
        
        // Populate Core Components
        function populateCoreComponents() {
            Object.entries(appData.components).forEach(([key, comp]) => {
                if (key === "User") return; // Skip user as it's not a system component in this context

                const compData = typeof comp === 'string' ? { title: key, description: comp } : comp;

                const card = document.createElement('div');
                card.className = 'p-6 bg-white rounded-lg shadow-md';
                
                let content = `<h3 class="text-xl font-semibold text-sky-600 mb-2">${compData.title}</h3>
                               <p class="text-slate-700">${compData.description}</p>`;
                
                if (compData.details && Array.isArray(compData.details)) {
                    content += '<ul class="list-disc list-inside mt-3 space-y-1 text-sm text-slate-600">';
                    compData.details.forEach(detail => {
                        content += `<li>${detail}</li>`;
                    });
                    content += '</ul>';
                }
                card.innerHTML = content;
                componentsContainer.appendChild(card);
            });
        }
        populateCoreComponents();

        // Populate Feature Flows
        appData.featureFlows.forEach(feature => {
            const option = document.createElement('option');
            option.value = feature.name;
            option.textContent = feature.name;
            featureSelect.appendChild(option);
        });

        featureSelect.addEventListener('change', (e) => {
            const selectedFeatureName = e.target.value;
            const feature = appData.featureFlows.find(f => f.name === selectedFeatureName);
            if (feature) {
                let flowHtml = `<h3 class="text-lg font-semibold text-sky-600 mb-3">${feature.name}</h3>
                                <ol class="list-decimal list-inside space-y-2 text-slate-700">`;
                feature.steps.forEach(step => {
                    flowHtml += `<li>${step.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`;
                });
                flowHtml += `</ol>`;
                featureFlowDisplay.innerHTML = flowHtml;
            } else {
                 featureFlowDisplay.innerHTML = `<p class="text-slate-500 italic">Select a feature from the dropdown above to see its detailed flow.</p>`;
            }
        });
        
        // Populate API Endpoints
        appData.apiEndpoints.forEach(group => {
            const groupDiv = document.createElement('div');
            groupDiv.className = 'p-4 bg-white rounded-lg shadow';
            let groupHtml = `<h3 class="text-lg font-semibold text-sky-600 mb-3">${group.group}</h3>
                             <div class="space-y-3">`;
            group.endpoints.forEach(ep => {
                groupHtml += `<div class="p-3 bg-slate-50 rounded border border-slate-200">
                                <p><strong class="font-mono text-sm ${ep.method === 'POST' ? 'text-green-600' : ep.method === 'GET' ? 'text-blue-600' : ep.method === 'PUT' ? 'text-yellow-600' : 'text-red-600'}">${ep.method}</strong> <code class="text-slate-700">${ep.path}</code></p>
                                <p class="text-sm text-slate-600">${ep.description}</p>`;
                if (ep.requestBody) {
                    groupHtml += `<details class="mt-1 text-xs">
                                    <summary class="cursor-pointer text-slate-500 hover:text-slate-700">Request Body</summary>
                                    <pre class="bg-slate-100 p-2 rounded mt-1 overflow-x-auto"><code class="language-json">${ep.requestBody.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
                                  </details>`;
                }
                if (ep.responseBody) {
                     groupHtml += `<details class="mt-1 text-xs">
                                    <summary class="cursor-pointer text-slate-500 hover:text-slate-700">Example Response</summary>
                                    <pre class="bg-slate-100 p-2 rounded mt-1 overflow-x-auto"><code class="language-json">${ep.responseBody.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code></pre>
                                  </details>`;
                }
                groupHtml += `</div>`;
            });
            groupHtml += `</div>`;
            groupDiv.innerHTML = groupHtml;
            apiEndpointsContainer.appendChild(groupDiv);
        });

        // Populate Database Schemas
        appData.databaseSchemas.forEach(schema => {
            const schemaDiv = document.createElement('div');
            schemaDiv.className = 'p-4 bg-white rounded-lg shadow';
            let schemaHtml = `<h3 class="text-lg font-semibold text-sky-600 mb-3">${schema.name}</h3>
                              <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-slate-200 text-sm">
                                    <thead class="bg-slate-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left font-medium text-slate-600">Field Name</th>
                                            <th class="px-4 py-2 text-left font-medium text-slate-600">Type</th>
                                            <th class="px-4 py-2 text-left font-medium text-slate-600">Description</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-slate-200">`;
            schema.fields.forEach(field => {
                schemaHtml += `<tr>
                                <td class="px-4 py-2 whitespace-nowrap text-slate-700"><code>${field.name}</code></td>
                                <td class="px-4 py-2 whitespace-nowrap text-slate-600">${field.type}</td>
                                <td class="px-4 py-2 text-slate-600">${field.description}</td>
                               </tr>`;
            });
            schemaHtml += `</tbody></table></div>`;
            schemaDiv.innerHTML = schemaHtml;
            databaseSchemasContainer.appendChild(schemaDiv);
        });

        // Populate Technology Stack
        let techHtml = '<ul class="list-disc list-inside space-y-3">';
        for (const [category, description] of Object.entries(appData.techStack)) {
            techHtml += `<li><strong class="font-semibold text-slate-700">${category}:</strong> <span class="text-slate-600">${description}</span></li>`;
        }
        techHtml += '</ul>';
        techstackContainer.innerHTML = techHtml;

        // Populate Security, Scalability, Error Handling
        securityContent.innerHTML = appData.security;
        scalabilityContent.innerHTML = appData.scalability;
        errorhandlingContent.innerHTML = appData.errorHandling;

    });
</script>
</body>
</html>
